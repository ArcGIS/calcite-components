<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />

    <title>Shell Panel</title>

    <script src="./_assets/head.js"></script>
    <script>
      const dojoConfig = {
        has: {
          "esri-layerlist-new-ui": 1,
        },
      };
    </script>
    <link rel="stylesheet" href="https://js.arcgis.com/next/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/next/"></script>
    <style>
      html,
      body,
      main,
      .shell-container {
        position: relative;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <demo-dom-swapper>
      <main>
        <div class="shell-container" style="width: 500px; height: 400px">
          <calcite-shell>
            <div>Shell Content</div>
            <calcite-shell-panel layout="horizontal" slot="panel-bottom" position="end">
              <calcite-action-bar slot="action-bar" expand-disabled>
                <calcite-button appearance="outline" id="popover-button-right" icon-start="popup">
                  Clickable popover</calcite-button
                >
              </calcite-action-bar>
              <calcite-flow custom-item-selectors="custom-flow-item">
                <calcite-flow-item heading="flow-item-1">
                  <div slot="content-top">Slot for a content-top.</div>
                  <img width="100" height="100" src="./_assets/images/placeholder.svg" />
                  <div slot="content-bottom">Content bottom!</div>
                  <div slot="footer">Footer!</div>
                </calcite-flow-item>
                <custom-flow-item heading="custom-flow-item">
                  <div slot="content-top">Slot for a content-top.</div>
                  <img width="100" height="100" src="./_assets/images/placeholder.svg" />
                  <div slot="content-bottom">Content bottom!</div>
                  <div slot="footer">Footer!</div>
                </custom-flow-item>
                <calcite-flow-item heading="flow-item-2">
                  <div slot="content-top">Slot for a content-top.</div>
                  <img width="100" height="100" src="./_assets/images/placeholder.svg" />
                  <div slot="content-bottom">Content bottom!</div>
                  <calcite-button
                    appearance="outline"
                    type="button"
                    slot="footer-start"
                    kind="neutral"
                    scale="s"
                    icon-start="check"
                    id="card-icon-test-1"
                    width="full"
                  ></calcite-button>
                  <calcite-button
                    appearance="outline"
                    slot="footer-end"
                    type="button"
                    scale="s"
                    icon-end="ellipsis"
                    kind="neutral"
                    id="card-icon-test-3"
                    width="full"
                  ></calcite-button>
                </calcite-flow-item>
              </calcite-flow>
            </calcite-shell-panel>
            <footer slot="footer">Footer</footer>
          </calcite-shell>
        </div>

        <!-- clickable popover -->
        <calcite-popover
          label="right start popover"
          reference-element="popover-button-right"
          placement="bottom"
          id="popover-right"
        >
          <div style="padding: 12px 16px">Hello! I am some popover content!</div>
          <calcite-flow custom-item-selectors="custom-flow-item">
            <calcite-flow-item heading="flow-item-1">
              <div slot="content-top">Slot for a content-top.</div>
              <img width="100" height="100" src="./_assets/images/placeholder.svg" />
              <div slot="content-bottom">Content bottom!</div>
              <div slot="footer">Footer!</div>
            </calcite-flow-item>
            <custom-flow-item heading="custom-flow-item">
              <div slot="content-top">Slot for a content-top.</div>
              <img width="100" height="100" src="./_assets/images/placeholder.svg" />
              <div slot="content-bottom">Content bottom!</div>
              <div slot="footer">Footer!</div>
            </custom-flow-item>
            <calcite-flow-item heading="flow-item-2">
              <div slot="content-top">Slot for a content-top.</div>
              <img width="100" height="100" src="./_assets/images/placeholder.svg" />
              <div slot="content-bottom">Content bottom!</div>
              <calcite-button
                type="button"
                slot="footer-start"
                kind="neutral"
                scale="s"
                id="card-icon-test-1"
                icon-start="check"
              ></calcite-button>
              <div slot="footer-end">
                <calcite-button type="button" scale="s" kind="neutral" id="card-icon-test-3" icon-start="ellipsis">
                </calcite-button>
              </div>
            </calcite-flow-item>
          </calcite-flow>
        </calcite-popover>

        <script>
          const shell = document.querySelector("calcite-shell");
          const shellPanels = document.querySelectorAll("calcite-shell-panel");

          const panelBottom = document.getElementById("panel-bottom");

          const actions = document.querySelectorAll("calcite-action");

          panelBottom.addEventListener("calcitePanelClose", function (event) {
            event.target.closest("calcite-shell-panel").collapsed = true;
          });

          actions.forEach((el) => {
            el.addEventListener("click", function (event) {
              const shellPanel = event.target.closest("calcite-shell-panel");
              const panel = shellPanel.querySelector("calcite-panel");
              shellPanel.collapsed = !shellPanel.collapsed;
              panel.closed = !panel.closed;
            });
          });

          class CustomFlowItem extends HTMLElement {
            constructor() {
              super();
              const shadow = this.attachShadow({ mode: "open" });

              shadow.innerHTML = `
                <style>
                  :host {
                    display: flex;
                    background: #bdf2c4;
                  }
                </style>
                <calcite-flow-item id="internalFlowItem">
                  <slot></slot>
                </calcite-flow-item>
              `;

              this.flowItemEl = shadow.getElementById("internalFlowItem");
            }

            connectedCallback() {
              this.flowItemEl.setAttribute("heading", this.getAttribute("heading"));
              this.flowItemEl.setAttribute("show-back-button", this.getAttribute("show-back-button"));
              this.flowItemEl.setAttribute("menu-open", this.getAttribute("menu-open"));
            }

            get heading() {
              return this.getAttribute("heading");
            }

            set heading(value) {
              this.flowItemEl.heading = value;
            }

            get hidden() {
              return this.hasAttribute("hidden");
            }

            set hidden(value) {
              this.toggleAttribute("hidden", value);
              this.flowItemEl.toggleAttribute("hidden", value);
            }

            get menuOpen() {
              return this.hasAttribute("menu-open");
            }

            set menuOpen(value) {
              this.toggleAttribute("menu-open", value);
              this.flowItemEl.menuOpen = value;
            }

            get showBackButton() {
              return this.hasAttribute("show-back-button");
            }

            set showBackButton(value) {
              this.toggleAttribute("show-back-button", value);
              this.flowItemEl.showBackButton = value;
            }

            async beforeBack() {
              // no op
            }

            async setFocus() {
              await this.flowItemEl.setFocus();
            }
          }

          customElements.define("custom-flow-item", CustomFlowItem);
        </script>
      </main>
    </demo-dom-swapper>
  </body>
</html>
