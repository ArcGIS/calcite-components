// theme variables
// light theme
:host {
  --calcite-alert-dismiss-progress-background: rgba(theme("backgroundColor.foreground.1"), theme("opacity.75"));
}

// // dark theme // TODO -- remove?
// :host([theme="dark"]) {
//   --calcite-alert-dismiss-progress-background: rgba(theme("backgroundColor.foreground.1"), theme("opacity.75"));
// }

// scale variables
:host([scale="s"]) {
  --calcite-alert-width: theme("maxWidth.xl");
  --calcite-alert-spacing-token-small: theme("spacing.2"); // // TODO - jrowlingson why?
  --calcite-alert-spacing-token-large: theme("spacing.4");
  @include slotted("alert-title", "*") {
    @apply text--2h;
  }
  @include slotted("alert-message", "*") {
    @apply text--3h;
  }
  ::slotted(calcite-link) {
    @apply text--3h;
  }
}

:host([scale="m"]) {
  --calcite-alert-width: theme("maxWidth.3xl");
  --calcite-alert-spacing-token-small: theme("spacing.4");
  --calcite-alert-spacing-token-large: theme("spacing.6");
  @include slotted("alert-title", "*") {
    @apply text--1h;
  }
  @include slotted("alert-message", "*") {
    @apply text--2h;
  }
  ::slotted(calcite-link) {
    @apply text--2h;
  }
}

:host([scale="l"]) {
  --calcite-alert-width: theme("maxWidth.4xl");
  --calcite-alert-spacing-token-small: theme("spacing.5");
  --calcite-alert-spacing-token-large: theme("spacing.8");
  @include slotted("alert-title", "*") {
    @apply text-0h;
  }
  @include slotted("alert-message", "*") {
    @apply text--1h;
  }
  ::slotted(calcite-link) {
    @apply text--1h;
  }
}

:host {
  @apply flex
    fixed
    justify-center
    items-center
    pointer-events-none
    bg-foreground-1
    rounded
    opacity-0
    inset-x-0
    bottom-0
    shadow-2;
  margin: 0 auto;
  width: var(--calcite-alert-width);
  max-width: 90%; // TODO
  max-height: 0; // TODO - wat
  z-index: 101; // TODO - z-50?
  transform: translate3d(0, $baseline, 0); // TODO
  transition: 300ms $easing-function, opacity 300ms $easing-function, all 0.15s ease-in-out; // TODO
  border-top: 0px solid transparent; // TODO
  @media only screen and (max-width: $viewport-medium) {
    @apply w-full max-w-full rounded-t;
  }
}

// focus styles
.alert-close {
  @apply focus-base;
  &:focus {
    @apply focus-inset;
  }
}

:host([active]:not([queued])) {
  @apply max-h-full opacity-0 pointer-events-auto border-t-2;
  transform: translate3d(0, -$baseline, 0); // TODO jrowlingson - transform-gpu

  @media only screen and (max-width: $viewport-medium) {
    transform: translate3d(0, 0, 0);
  }
}

@include slotted("alert-title", "*") {
  @apply text-0h text-color-1 m-0 font-medium;
}

@include slotted("alert-message", "*") {
  @apply inline m-0 mr-3 font-normal text--1h text-color-2;
}

:host([dir="rtl"]) {
  @include slotted("alert-message", "*") {
    @apply mr-0 ml-3;
  }
}

@mixin alert-element-base() {
  padding: var(--calcite-alert-spacing-token-small) var(--calcite-alert-spacing-token-large); // TODO - jrowlingson
  flex: 0 0 auto; // TODO - jrowlingson
  transition: all 0.15s ease-in-out; // TODO - jrowlingson

  @media only screen and (max-width: $viewport-medium) {
    @apply p-5;
  }
}

.alert-content {
  @include alert-element-base; // TODO - jrowlingson
  @apply flex-auto break-words min-w-0;
  flex: 1 1 auto; // TODO - jrowlingson
  padding: var(--calcite-alert-spacing-token-small) var(--calcite-alert-spacing-token-small)
    var(--calcite-alert-spacing-token-small) 0;

  &:first-of-type:not(:only-child) {
    padding-left: var(--calcite-alert-spacing-token-large);
  }
  &:only-child {
    padding: var(--calcite-alert-spacing-token-small);
  }

  @media only screen and (max-width: $viewport-medium) {
    padding: var(--calcite-alert-spacing-token-large) var(--calcite-alert-spacing-token-small)
      var(--calcite-alert-spacing-token-large) 0;
  }
}

:host([dir="rtl"]) {
  .alert-content {
    padding: var(--calcite-alert-spacing-token-small) 0 var(--calcite-alert-spacing-token-small)
      var(--calcite-alert-spacing-token-small);

    &:first-of-type:not(:only-child) {
      padding-right: var(--calcite-alert-spacing-token-large);
    }
    @media only screen and (max-width: $viewport-medium) {
      padding: var(--calcite-alert-spacing-token-large) 0 var(--calcite-alert-spacing-token-large)
        var(--calcite-alert-spacing-token-small);
    }
  }
}
.alert-icon {
  @include alert-element-base; // TODO - jrowlingson
  @apply py-0 flex items-center self-stretch;
}

.alert-close {
  @include alert-element-base; // TODO - jrowlingson
  @apply py-0
    self-stretch
    bg-transparent
    border-none
    outline-none
    cursor-pointer
    text-color-3
    rounded-br
    overflow-hidden;
  -webkit-appearance: none;
  &:hover,
  &:focus {
    @apply bg-foreground-2;
  }

  &:active {
    @apply bg-foreground-3;
  }
  @media only screen and (max-width: $viewport-medium) {
    @apply rounded-none;
  }
}
:host([dir="rtl"]) {
  .alert-close {
    @apply rounded-none rounded-bl; // TODO - jrowlingson
  }
}
.alert-queue-count {
  @apply text--2h
    flex
    items-center
    justify-around
    self-stretch
    w-0
    invisible
    font-medium
    text-center
    text-color-2
    opacity-0
    cursor-default
    overflow-hidden;
  border-left: 0px solid transparent; // TODO - jrowlingson
  border-right: 0px solid transparent; // TODO - jrowlingson
  transition: all 0.15s ease-in-out; // TODO - jrowlingson

  &.active {
    // TODO - jrowlingson - padding
    @apply visible
      opacity-100
      px-1
      w-12
      border-l
      border-r
      border-color-3;
  }

  @media only screen and (max-width: $viewport-medium) {
    @apply rounded-none;
  }
}

:host([auto-dismiss]) > .alert-queue-count {
  @apply border-r-0;
}

:host([auto-dismiss][dir="rtl"]) > .alert-queue-count {
  @apply border-l-0;
}

.alert-dismiss-progress {
  @apply block absolute inset-x-0 w-full h-1 hidden rounded-t;
  // top: -3px; // TODO - jrowlingson
  top: -4px; // TODO - jrowlingson
  z-index: 103; // TODO - jrowlingson
  &:after {
    @apply h-1 top-0 right-0 block absolute;
    content: "";
    background-color: var(--calcite-alert-dismiss-progress-background);
    z-index: 104; // // TODO - jrowlingson
  }
}

:host([dir="rtl"]) .alert-dismiss-progress:after {
  @apply left-0;
  right: initial; // TODO - jrowlingson
}

// TODO - jrowlingson
$alertColors: "blue" var(--calcite-ui-brand), "red" var(--calcite-ui-danger), "yellow" var(--calcite-ui-warning),
  "green" var(--calcite-ui-success);

@each $alertColor in $alertColors {
  $name: nth($alertColor, 1);
  $color: nth($alertColor, 2);

  :host([color="#{$name}"]) {
    border-top-color: $color;
    & .alert-icon {
      color: $color;
    }
  }
}

$alertDurations: "fast" 6000ms, "medium" 10000ms, "slow" 14000ms;

@each $alertDuration in $alertDurations {
  $name: nth($alertDuration, 1);
  $duration: nth($alertDuration, 2);

  :host([auto-dismiss-duration="#{$name}"]) .alert-dismiss-progress:after {
    animation: dismissProgress $duration ease-out;
  }
}

@keyframes dismissProgress {
  0% {
    @apply w-0 opacity-75;
  }
  100% {
    @apply w-full opacity-100;
  }
}
