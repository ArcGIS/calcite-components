<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Radio Group</title>
    <style>
      .parent-flex {
        display: flex;
        padding: 20px 0;
        width: 70%;
      }

      .parent-flex,
      span {
        color: var(--calcite-ui-text-3);
        font-family: var(--calcite-sans-family);
        font-weight: var(--calcite-font-weight-medium);
        font-size: var(--calcite-font-size-0);
      }

      .child-flex {
        flex: 0 0 21%;
        padding-right: 30px;
      }

      .width-child-flex {
        flex: 0 0 100%;
      }

      hr {
        margin: 50px 0;
        border-top: 1px solid var(--calcite-ui-border-2);
      }

      .right-aligned-text {
        text-align: right;
      }
    </style>
    <script src="./_assets/head.js"></script>
  </head>

  <body>
    <h3>Repro Steps</h3>
    <ol>
      <li>Select a different <code>calcite-radio-group-item</code></li>
      <li>Click the "Toggle Radio Group" button twice</li>
      <li>Open and clear the console</li>
      <li>Select the "Layers" item (or any item before the currently selected one)</li>
      <li>Notice that the <code>calciteRadioGroupChange</code> fires multiple times</li>
    </ol>
    <calcite-button id="toggleRadioGroup">Toggle Radio Group</calcite-button>
  </body>
  <script type="module">
    let isRadioVisible = false;
    let checkedValue = "layers";
    const radioGroupString = `<calcite-radio-group id="radioGroup">
     <calcite-radio-group-item value="layers">Layers</calcite-radio-group-item>
     <calcite-radio-group-item value="data">Data</calcite-radio-group-item>
     <calcite-radio-group-item value="geography">Geography</calcite-radio-group-item>
     <calcite-radio-group-item value="maps">Maps</calcite-radio-group-item>
   </calcite-radio-group>`;

    const onRadioToggle = () => {
      isRadioVisible = !isRadioVisible;
      if (isRadioVisible) {
        const radioGroup = document.createRange().createContextualFragment(radioGroupString);

        document.body.appendChild(radioGroup);

        // re-check the previously checked item
        document.querySelector(`calcite-radio-group-item[value="${checkedValue}"]`).checked = true;
      } else {
        console.log("removed");
        document.querySelector("#radioGroup").remove();
      }
    };

    // button click event listener
    document.querySelector("#toggleRadioGroup").addEventListener("click", onRadioToggle);

    // radio-group change event listener
    document.addEventListener("calciteRadioGroupChange", (e) => {
      console.log("event added");
      checkedValue = e.detail;
      console.log(`calciteRadioGroupChange, value: ${checkedValue}`);
    });

    // onRadioToggle()
  </script>
</html>
